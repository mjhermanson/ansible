---
- name: configure idrac raid cards
  become: "no"
  gather_facts: "no"
  hosts:
    - myhosts
  tasks:
    - name: create raid 0 jobs
      raw: racadm raid createvd:RAID.Integrated.1-1 -rl r0 -pdkey:Disk.Bay.{{ item }}:Enclosure.Internal.0-1:RAID.Integrated.1-1
      with_sequence: start=2 end=15
    - name: schedule the job
      raw: racadm jobqueue create RAID.Integrated.1-1
    - name: powercycle
      raw: racadm serveraction powercycle
    - name: waiting for server to come back
      become: false
      local_action:
        module: wait_for
         host={{ inventory_hostname }}
         port=22
         delay=1
         timeout=300
      when: reboot is defined
